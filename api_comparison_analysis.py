#!/usr/bin/env python3\n\"\"\"\nDetailed comparison between working manualrun.py and web system API calls\n\"\"\"\n\nimport json\n\ndef analyze_working_vs_web_system():\n    print(\"üîç DETAILED API COMPARISON ANALYSIS\")\n    print(\"=\" * 60)\n    \n    # Your working manualrun.py script\n    working_script = {\n        \"url\": \"https://api.brightdata.com/datasets/v3/trigger\",\n        \"headers\": {\n            \"Authorization\": \"Bearer c20a28d5-5c6c-43c3-9567-a6d7c193e727\",\n            \"Content-Type\": \"application/json\",\n        },\n        \"params\": {\n            \"dataset_id\": \"gd_lk5ns7kz21pck8jpis\",\n            \"endpoint\": \"https://api.upsun-deployment-xiwfmii-inhoolfrqniuu.eu-5.platformsh.site/api/brightdata/webhook/\",\n            \"format\": \"json\",\n            \"uncompressed_webhook\": \"true\",\n            \"include_errors\": \"true\",\n            \"type\": \"discover_new\",\n            \"discover_by\": \"url\",\n        },\n        \"data\": [\n            {\"url\":\"https://www.instagram.com/oneshift\",\"num_of_posts\":2,\"start_date\":\"01-01-2025\",\"end_date\":\"06-16-2025\",\"post_type\":\"Post\"}\n        ]\n    }\n    \n    # Web system (from views.py trigger_instagram_scrape)\n    web_system = {\n        \"url\": \"https://api.brightdata.com/datasets/v3/trigger\",\n        \"headers\": {\n            \"Authorization\": \"Bearer {config.api_token}\",  # From database\n            \"Content-Type\": \"application/json\",\n        },\n        \"params\": {\n            \"dataset_id\": \"{config.dataset_id}\",  # From database\n            \"endpoint\": \"https://api.upsun-deployment-xiwfmii-inhoolfrqniuu.eu-5.platformsh.site/api/brightdata/webhook/\",\n            \"format\": \"json\",\n            \"uncompressed_webhook\": \"true\",\n            \"include_errors\": \"true\",\n            \"type\": \"discover_new\",\n            \"discover_by\": \"url\",\n        },\n        \"data\": [\n            {\n                \"url\": \"{target_url}\",\n                \"num_of_posts\": \"{num_of_posts}\",\n                \"start_date\": \"{start_date}\",\n                \"end_date\": \"{end_date}\",\n                \"post_type\": \"Post\",\n                \"posts_to_not_include\": []\n            }\n        ]\n    }\n    \n    print(\"\\nüìä COMPARISON RESULTS:\")\n    print(\"=\" * 30)\n    \n    print(\"\\n1. ‚úÖ URL - IDENTICAL:\")\n    print(f\"   Working: {working_script['url']}\")\n    print(f\"   Web Sys: {web_system['url']}\")\n    \n    print(\"\\n2. ‚ö†Ô∏è  HEADERS - POTENTIALLY DIFFERENT:\")\n    print(f\"   Working: {working_script['headers']['Authorization']}\")\n    print(f\"   Web Sys: {web_system['headers']['Authorization']} (from database)\")\n    print(\"   ‚Üí Need to verify database config has correct token\")\n    \n    print(\"\\n3. ‚ö†Ô∏è  PARAMS - POTENTIALLY DIFFERENT:\")\n    print(\"   Working params:\")\n    for key, value in working_script['params'].items():\n        print(f\"     {key}: {value}\")\n    \n    print(\"   Web system params:\")\n    for key, value in web_system['params'].items():\n        print(f\"     {key}: {value}\")\n    \n    print(\"   ‚Üí Need to verify database config has correct dataset_id\")\n    \n    print(\"\\n4. ‚ö†Ô∏è  DATA PAYLOAD - MINOR DIFFERENCES:\")\n    print(\"   Working data:\")\n    print(f\"     {json.dumps(working_script['data'][0], indent=6)}\")\n    \n    print(\"   Web system data:\")\n    print(f\"     {json.dumps(web_system['data'][0], indent=6)}\")\n    \n    print(\"   ‚Üí Web system adds 'posts_to_not_include': [] (should be fine)\")\n    \n    print(\"\\n\" + \"=\" * 60)\n    print(\"üéØ KEY ISSUES TO CHECK:\")\n    print(\"=\" * 60)\n    \n    print(\"\\n1. üîë DATABASE CONFIGURATION:\")\n    print(\"   Check BrightdataConfig table for instagram_posts:\")\n    print(f\"   - api_token should be: c20a28d5-5c6c-43c3-9567-a6d7c193e727\")\n    print(f\"   - dataset_id should be: gd_lk5ns7kz21pck8jpis\")\n    \n    print(\"\\n2. üì° ENDPOINT URL:\")\n    print(\"   ‚úÖ Already fixed - both use same Upsun URL\")\n    \n    print(\"\\n3. üîß EXTRA PARAMETERS:\")\n    print(\"   ‚úÖ Already removed auth_header and notify\")\n    \n    print(\"\\n4. üìù DATA FORMAT:\")\n    print(\"   ‚úÖ Mostly identical, extra 'posts_to_not_include' is harmless\")\n    \n    print(\"\\n\" + \"=\" * 60)\n    print(\"üõ†Ô∏è  RECOMMENDED ACTIONS:\")\n    print(\"=\" * 60)\n    \n    print(\"\\n1. Verify database configuration\")\n    print(\"2. Test web system with same parameters as manualrun.py\")\n    print(\"3. Check logs for any remaining differences\")\n    \n    return {\n        'working_script': working_script,\n        'web_system': web_system\n    }\n\nif __name__ == \"__main__\":\n    analysis = analyze_working_vs_web_system()\n    \n    print(\"\\n\" + \"=\" * 60)\n    print(\"üìã SUMMARY\")\n    print(\"=\" * 60)\n    \n    print(\"\\nThe main differences are likely:\")\n    print(\"1. Database config values (api_token, dataset_id)\")\n    print(\"2. Minor data payload differences (posts_to_not_include)\")\n    print(\"\\nThe API structure is now identical after our fixes!\")\n```
